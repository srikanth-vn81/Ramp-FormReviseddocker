{% extends "base_step.html" %}

{% block title %}Training Support - WFM Analytics{% endblock %}

{% block form_content %}
<!-- Training Schedule Card -->
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h6 class="card-title mb-0">
                    <i class="fas fa-calendar-alt me-2"></i>Training Support
                </h6>
            </div>
            <div class="card-body">
                <!-- Training Support Availability Section -->
                <div class="mb-4">
                    <div class="form-label fw-bold text-success mb-3">
                        <i class="fas fa-question-circle me-2"></i>Training Support Availability
                    </div>
                    <div class="card border-0 shadow-sm bg-light">
                        <div class="card-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-bold text-dark mb-3">
                                        Do you have Training Support Details?
                                    </label>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-check form-check-inline p-3 border rounded bg-white shadow-sm">
                                                <input class="form-check-input" type="radio" name="training-availability" id="training-available" value="available" onchange="toggleTrainingDetails()">
                                                <label class="form-check-label fw-bold text-success ms-2" for="training-available">
                                                    <i class="fas fa-check-circle me-2"></i>Available
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check form-check-inline p-3 border rounded bg-white shadow-sm">
                                                <input class="form-check-input" type="radio" name="training-availability" id="training-unavailable" value="unavailable" onchange="toggleTrainingDetails()">
                                                <label class="form-check-label fw-bold text-secondary ms-2" for="training-unavailable">
                                                    <i class="fas fa-times-circle me-2"></i>Currently Unavailable
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Training Support Content (Initially Hidden) -->
                <div id="training-support-content" style="display: none;">
                <!-- Trainer Details -->
                <div id="trainer-details" class="row g-3 mb-4" style="display: none;">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <h6><i class="fas fa-users me-2"></i>Trainer Details</h6>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-semibold required">Client Trainer</label>
                        {{ form.client_trainer(class="form-select") }}
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-semibold required">Internal Trainer</label>
                        {{ form.internal_trainer(class="form-select") }}
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-semibold required"># of Total Trainer</label>
                        {{ form.total_trainers(class="form-control", readonly=true, style="background-color: #f8f9fa; color: #495057;", value="0") }}
                    </div>
                </div>

                </div> <!-- End of training-support-content -->
                
                <!-- Save Button at End of Form -->
                <div class="text-end mt-3">
                    <button type="submit" name="action" value="save" class="btn btn-sm btn-outline-primary" title="Save Progress">
                        <i class="fas fa-save me-1" style="font-size: 0.75rem;"></i>Save
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Toggle Training Support Details based on availability selection
function toggleTrainingDetails() {
    const selectedRadio = document.querySelector('input[name="training-availability"]:checked');
    const availability = selectedRadio ? selectedRadio.value : '';
    const content = document.getElementById('training-support-content');
    const trainerDetails = document.getElementById('trainer-details');
    
    if (availability === 'available') {
        content.style.display = 'block';
        trainerDetails.style.display = 'block';
    } else {
        content.style.display = 'none';
        trainerDetails.style.display = 'none';
        // Clear all form data when hiding
        clearTrainingFormData();
    }
}

// Clear all training form data
function clearTrainingFormData() {
    // Clear all select fields
    document.querySelectorAll('select[name="client_trainer"], select[name="internal_trainer"]').forEach(function(select) {
        select.value = '';
    });
    
    // Clear total trainers fields
    document.querySelectorAll('input[name="total_trainers"]').forEach(function(input) {
        input.value = '0';
    });
}

document.addEventListener('DOMContentLoaded', function() {
    // Calculate total trainers based on trainer selections
    function calculateTotalTrainers() {
        let total = 0;
        
        // Get values from both trainer fields
        const clientField = document.querySelector('#trainer-details select[name="client_trainer"]');
        const internalField = document.querySelector('#trainer-details select[name="internal_trainer"]');
        
        const client = parseInt(clientField?.value) || 0;
        const internal = parseInt(internalField?.value) || 0;
        total = client + internal;
        
        // Update total trainer field
        const totalField = document.querySelector('#trainer-details input[name="total_trainers"]');
        if (totalField) {
            totalField.value = total;
        }
    }
    
    // Bind change listeners to trainer selects
    document.querySelectorAll('select[name="client_trainer"], select[name="internal_trainer"]').forEach(el => {
        el.addEventListener('change', calculateTotalTrainers);
    });
    
    // Initialize visibility if "Available" is already selected
    const selectedAvailability = document.querySelector('input[name="training-availability"]:checked');
    if (selectedAvailability && selectedAvailability.value === 'available') {
        document.getElementById('training-support-content').style.display = 'block';
        document.getElementById('trainer-details').style.display = 'block';
        calculateTotalTrainers();
    }
});
</script>
{% endblock %}